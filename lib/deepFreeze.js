"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class DeepFreeze extends Function {
    constructor() {
        super();
        const globalThisWhitelist = (() => {
            const wl = new WeakSet();
            const q = [globalThis];
            while (q.length) {
                const cur = q.pop();
                if (cur instanceof Object && !wl.has(cur)) {
                    wl.add(cur);
                    q.push(Object.getPrototypeOf(cur));
                    Object.values(Object.getOwnPropertyDescriptors(cur))
                        .reduce((a, v) => a.concat(Object.values(v)), [])
                        .forEach(x => q.push(x));
                }
            }
            return wl;
        })();
        const self = freezeRoot => {
            if (!(freezeRoot instanceof Object)) {
                return freezeRoot;
            }
            const visited = new WeakSet();
            const q = [freezeRoot];
            while (q.length) {
                const cur = q.pop();
                if (cur instanceof Object && !visited.has(cur)) {
                    visited.add(cur);
                    if (!globalThisWhitelist.has(cur)) {
                        Object.freeze(cur);
                    }
                    q.push(Object.getPrototypeOf(cur));
                    Object.values(Object.getOwnPropertyDescriptors(cur))
                        .reduce((a, v) => a.concat(Object.values(v)), [])
                        .forEach(x => q.push(x));
                }
            }
            if (!globalThisWhitelist.has(freezeRoot)) {
                Object.freeze(freezeRoot);
            }
            return freezeRoot;
        };
        return Object.freeze(Object.setPrototypeOf(self, DeepFreeze.prototype));
    }
}
exports.DeepFreeze = DeepFreeze;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVlcEZyZWV6ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9kZWVwRnJlZXplLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBaURBLE1BQWEsVUFBVyxTQUFRLFFBQVE7SUFDdkM7UUFDQyxLQUFLLEVBQUUsQ0FBQztRQUNSLE1BQU0sbUJBQW1CLEdBQUcsQ0FBQyxHQUFHLEVBQUU7WUFDakMsTUFBTSxFQUFFLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUN6QixNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3ZCLE9BQU8sQ0FBQyxDQUFDLE1BQU0sRUFBRTtnQkFDaEIsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUNwQixJQUFJLEdBQUcsWUFBWSxNQUFNLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO29CQUMxQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNaLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNuQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxHQUFHLENBQUMsQ0FBQzt5QkFDbEQsTUFBTSxDQUFDLENBQUMsQ0FBUSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO3lCQUN2RCxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQzFCO2FBQ0Q7WUFDRCxPQUFPLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDTCxNQUFNLElBQUksR0FBZSxVQUFVLENBQUMsRUFBRTtZQUNyQyxJQUFJLENBQUMsQ0FBQyxVQUFVLFlBQVksTUFBTSxDQUFDLEVBQUU7Z0JBQ3BDLE9BQU8sVUFBVSxDQUFDO2FBQ2xCO1lBQ0QsTUFBTSxPQUFPLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUM5QixNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3ZCLE9BQU8sQ0FBQyxDQUFDLE1BQU0sRUFBRTtnQkFDaEIsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUNwQixJQUFJLEdBQUcsWUFBWSxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO29CQUMvQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNqQixJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO3dCQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO3FCQUNuQjtvQkFDRCxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDbkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMseUJBQXlCLENBQUMsR0FBRyxDQUFDLENBQUM7eUJBQ2xELE1BQU0sQ0FBQyxDQUFDLENBQVEsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQzt5QkFDdkQsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUMxQjthQUNEO1lBQ0QsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsRUFBRTtnQkFDekMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQzthQUMxQjtZQUNELE9BQU8sVUFBVSxDQUFDO1FBQ25CLENBQUMsQ0FBQztRQUNGLE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUN6RSxDQUFDO0NBQ0Q7QUE1Q0QsZ0NBNENDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbW9kdWxlIHJlc3RyaWN0LXZcbiAqL1xuXG4vKipcbiAqIEBhdXRob3IgIEp1c3RpbiBDb2xsaWVyIDxqcGN4aXN0QGdtYWlsLmNvbT5cbiAqIEBsaWNlbnNlIEdQTC0zLjAtb3ItbGF0ZXJcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9naXRodWIuY29tL2pwY3gvcmVzdHJpY3QtdnxHaXRIdWJ9XG4gKi9cblxuLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAgKlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAgKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXyAgICAgICAgIC5fXyAgICAgICAgX18gICAgICAgICAgICAgICAgICAgICAgKlxuICogICAgX19fX19fXyAgIF9fX18gICBfX19fX19fLyAgfF9fX19fX19ffF9ffCBfX19fXy8gIHxfICAgICAgICAgIF9fXyAgX18gICAgKlxuICogICAgXFxfICBfXyBcXF8vIF9fIFxcIC8gIF9fXy9cXCAgIF9fXFxfICBfXyBcXCAgfC8gX19fXFwgICBfX1xcICBfX19fX18gXFwgIFxcLyAvICAgICpcbiAqICAgICB8ICB8IFxcL1xcICBfX18vIFxcX19fIFxcICB8ICB8ICB8ICB8IFxcLyAgXFwgIFxcX19ffCAgfCAgIC9fX19fXy8gIFxcICAgLyAgICAgKlxuICogICAgIHxfX3wgICAgXFxfX18gID5fX19fICA+IHxfX3wgIHxfX3wgIHxfX3xcXF9fXyAgPl9ffCAgICAgICAgICAgICBcXF8vICAgICAgKlxuICogICAgICAgICAgICAgICAgIFxcLyAgICAgXFwvICAgICAgICAgICAgICAgICAgICAgIFxcLyAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgUnVudGltZSBWYWx1ZSBSZXN0cmljdG9yICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAgKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAgKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5ICAgICAgKlxuICogIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5ICAgICAgKlxuICogIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yICAgICAgICAgKlxuICogIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCAgICAgICAgICAgKlxuICogIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbnRlcm5hbGllZCB3YXJyYW50eSBvZiAgICAgICAgKlxuICogIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgICAgICAgICAgICAgKlxuICogIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlICAgICAgICAgKlxuICogIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4gICAgKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cblxuLyouLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSxcbiAvICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY2xhc3MuRGVlcEZyZWV6ZV0gICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8gXG5cbi8qKlxuICogVXBvbiBjb25zdHJ1Y3Rpb24sIHdoaXRlbGlzdHMgYWxsIGRlZXAgcHJvcGVydGllcyBhbmQgcHJvdG90eXBlIGNoYWlucyBpbiB0aGVcbiAqIGdsb2JhbFRoaXMgb2JqZWN0LiBVcG9uIGZ1bmN0aW9uIHVzZSwgZnJlZXplcyBhbnkgZGVlcCBwcm9wZXJ0aWVzIGFuZFxuICogcHJvdG90eXBlIGNoYWlucyBhdHRhY2hlZCB0byB0aGUgcHJvdmlkZWQgb2JqZWN0IHRoYXQgYXJlIG5vdCBpbiB0aGVcbiAqIGdsb2JhbFRoaXMgd2hpdGVsaXN0LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIERlZXBGcmVlemUgZXh0ZW5kcyBGdW5jdGlvbiB7XG5cdDxUIGV4dGVuZHMgb2JqZWN0PihmcmVlemVSb290OiBUKTogVDtcbn1cbmV4cG9ydCBjbGFzcyBEZWVwRnJlZXplIGV4dGVuZHMgRnVuY3Rpb24ge1xuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHRzdXBlcigpO1xuXHRcdGNvbnN0IGdsb2JhbFRoaXNXaGl0ZWxpc3QgPSAoKCkgPT4ge1xuXHRcdFx0Y29uc3Qgd2wgPSBuZXcgV2Vha1NldCgpO1xuXHRcdFx0Y29uc3QgcSA9IFtnbG9iYWxUaGlzXTtcblx0XHRcdHdoaWxlIChxLmxlbmd0aCkge1xuXHRcdFx0XHRjb25zdCBjdXIgPSBxLnBvcCgpO1xuXHRcdFx0XHRpZiAoY3VyIGluc3RhbmNlb2YgT2JqZWN0ICYmICF3bC5oYXMoY3VyKSkge1xuXHRcdFx0XHRcdHdsLmFkZChjdXIpO1xuXHRcdFx0XHRcdHEucHVzaChPYmplY3QuZ2V0UHJvdG90eXBlT2YoY3VyKSk7XG5cdFx0XHRcdFx0T2JqZWN0LnZhbHVlcyhPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhjdXIpKVxuXHRcdFx0XHRcdFx0LnJlZHVjZSgoYTogYW55W10sIHYpID0+IGEuY29uY2F0KE9iamVjdC52YWx1ZXModikpLCBbXSlcblx0XHRcdFx0XHRcdC5mb3JFYWNoKHggPT4gcS5wdXNoKHgpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHdsO1xuXHRcdH0pKCk7XG5cdFx0Y29uc3Qgc2VsZjogRGVlcEZyZWV6ZSA9IGZyZWV6ZVJvb3QgPT4ge1xuXHRcdFx0aWYgKCEoZnJlZXplUm9vdCBpbnN0YW5jZW9mIE9iamVjdCkpIHtcblx0XHRcdFx0cmV0dXJuIGZyZWV6ZVJvb3Q7XG5cdFx0XHR9XG5cdFx0XHRjb25zdCB2aXNpdGVkID0gbmV3IFdlYWtTZXQoKTtcblx0XHRcdGNvbnN0IHEgPSBbZnJlZXplUm9vdF07XG5cdFx0XHR3aGlsZSAocS5sZW5ndGgpIHtcblx0XHRcdFx0Y29uc3QgY3VyID0gcS5wb3AoKTtcblx0XHRcdFx0aWYgKGN1ciBpbnN0YW5jZW9mIE9iamVjdCAmJiAhdmlzaXRlZC5oYXMoY3VyKSkge1xuXHRcdFx0XHRcdHZpc2l0ZWQuYWRkKGN1cik7XG5cdFx0XHRcdFx0aWYgKCFnbG9iYWxUaGlzV2hpdGVsaXN0LmhhcyhjdXIpKSB7XG5cdFx0XHRcdFx0XHRPYmplY3QuZnJlZXplKGN1cik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHEucHVzaChPYmplY3QuZ2V0UHJvdG90eXBlT2YoY3VyKSk7XG5cdFx0XHRcdFx0T2JqZWN0LnZhbHVlcyhPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhjdXIpKVxuXHRcdFx0XHRcdFx0LnJlZHVjZSgoYTogYW55W10sIHYpID0+IGEuY29uY2F0KE9iamVjdC52YWx1ZXModikpLCBbXSlcblx0XHRcdFx0XHRcdC5mb3JFYWNoKHggPT4gcS5wdXNoKHgpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYgKCFnbG9iYWxUaGlzV2hpdGVsaXN0LmhhcyhmcmVlemVSb290KSkge1xuXHRcdFx0XHRPYmplY3QuZnJlZXplKGZyZWV6ZVJvb3QpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGZyZWV6ZVJvb3Q7XG5cdFx0fTtcblx0XHRyZXR1cm4gT2JqZWN0LmZyZWV6ZShPYmplY3Quc2V0UHJvdG90eXBlT2Yoc2VsZiwgRGVlcEZyZWV6ZS5wcm90b3R5cGUpKTtcblx0fVxufVxuIl19