"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const deepFreeze_1 = require("./deepFreeze");
const deepFreeze = new deepFreeze_1.DeepFreeze();
const restriction_1 = require("./restriction");
exports.restrict = (() => {
    const primitive = {
        string: new restriction_1.Restriction("Must be a 'string'", (v) => typeof v === "string"),
        number: new restriction_1.Restriction("Must be a 'number'", (v) => typeof v === "number"),
        bigint: new restriction_1.Restriction("Must be a 'bigint'", (v) => typeof v === "bigint"),
        boolean: new restriction_1.Restriction("Must be a 'boolean'", (v) => typeof v === "boolean"),
        null: new restriction_1.Restriction("Must be null", (v) => v === null),
        undefined: new restriction_1.Restriction("Must be 'undefined'", (v) => typeof v === "undefined"),
        symbol: new restriction_1.Restriction("Must be a 'symbol'", (v) => typeof v === "symbol")
    };
    const equality = {
        eq: (target) => new restriction_1.Restriction("Must be strictly equal to " + target, (v) => v === target),
        neq: (target) => new restriction_1.Restriction("Must not be strictly equal to " + target, (v) => v !== target)
    };
    const range = {
        integer: new restriction_1.Restriction("Must be an integer", (v) => {
            if (typeof v === "bigint") {
                return true;
            }
            else if (typeof v === "number") {
                return Math.floor(v) === v;
            }
            else {
                return false;
            }
        }),
        gt: (bound) => {
            if (typeof bound === "number" || typeof bound === "bigint") {
                return new restriction_1.Restriction(`Must be a '${typeof bound}' greater than ${bound}`, (v) => typeof v === typeof bound && v > bound);
            }
            else {
                throw new Error("[restrict-v] Invalid Argument: restrict.gt creation requires a " +
                    "bound of type 'number' or 'bigint'");
            }
        },
        lt: (bound) => {
            if (typeof bound === "number" || typeof bound === "bigint") {
                return new restriction_1.Restriction(`Must be a '${typeof bound}' less than ${bound}`, (v) => typeof v === typeof bound && v < bound);
            }
            else {
                throw new Error("[restrict-v] Invalid Argument: restrict.lt creation requires " +
                    "a bound of type 'number' or 'bigint'");
            }
        },
        gte: (bound) => {
            if (typeof bound === "number" || typeof bound === "bigint") {
                return new restriction_1.Restriction(`Must be a '${typeof bound}' greater than or equal to ${bound}`, (v) => typeof v === typeof bound && v >= bound);
            }
            else {
                throw new Error("[restrict-v] Invalid Argument: restrict.gte creation requires " +
                    "a bound of type 'number' or 'bigint'");
            }
        },
        lte: (bound) => {
            if (typeof bound === "number" || typeof bound === "bigint") {
                return new restriction_1.Restriction(`Must be a '${typeof bound}' less than or equal to ${bound}`, (v) => typeof v === typeof bound && v <= bound);
            }
            else {
                throw new Error("[restrict-v] Invalid Argument: restrict.lte creation requires " +
                    "a bound of type 'number' or 'bigint'");
            }
        },
        range: (lower, upper, lowerInclusive = true, upperInclusive = false) => {
            if (typeof lower === typeof upper &&
                (typeof lower === "number" || typeof lower === "bigint")) {
                return new restriction_1.Restriction(`Must be a '${typeof lower}' within the range ${lowerInclusive ? "[" : "("}${lower}, ${upper}${upperInclusive ? "]" : ")"}`, lowerInclusive ? range.gte(lower) : range.gt(lower), upperInclusive ? range.lte(upper) : range.lt(upper));
            }
            else {
                throw new Error("[restrict-v] Invalid Argument: restrict.range creation requires " +
                    "same-typed lower and upper bounds of type 'number' or 'bigint'");
            }
        }
    };
    const rangePresets = {
        positive: range
            .gte(0)
            .or(range.gte(BigInt(0)))
            .msg("Must be a positive 'number' or 'bigint'"),
        negative: range
            .lt(0)
            .or(range.lt(BigInt(0)))
            .msg("Must be a negative 'number' or 'bigint'")
    };
    const instances = {
        Object: new restriction_1.Restriction("Must be an instance of Object", (v) => v instanceof Object),
        Array: new restriction_1.Restriction("Must be an instance of Array", (v) => v instanceof Array),
        instanceof: (instance) => new restriction_1.Restriction(`Must be an instance of ${instance.name}`, (value) => value instanceof instance)
    };
    const strings = {
        match: (matcher) => {
            if (matcher instanceof RegExp) {
                return primitive.string.and("Must be a 'string' matching " + matcher.toString(), (v) => v.match(matcher));
            }
            else if (typeof matcher === "string") {
                return primitive.string.and("Must be a 'string' matching '" + matcher + "'", (v) => v.match(matcher));
            }
            else {
                throw Error("[restrict-v] Invalid Argument: Must supply a string or RegExp " +
                    "instance for restrict.match creation");
            }
        }
    };
    return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, primitive), equality), range), rangePresets), instances), strings);
})();
deepFreeze(this);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdHJpY3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcmVzdHJpY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFxQ0EsNkNBQTBDO0FBQzFDLE1BQU0sVUFBVSxHQUFHLElBQUksdUJBQVUsRUFBRSxDQUFDO0FBSXBDLCtDQUE0QztBQUUvQixRQUFBLFFBQVEsR0FBRyxDQUFDLEdBQUcsRUFBRTtJQUM3QixNQUFNLFNBQVMsR0FBRztRQUNqQixNQUFNLEVBQUUsSUFBSSx5QkFBVyxDQUN0QixvQkFBb0IsRUFDcEIsQ0FBQyxDQUFTLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLFFBQVEsQ0FDcEM7UUFDRCxNQUFNLEVBQUUsSUFBSSx5QkFBVyxDQUN0QixvQkFBb0IsRUFDcEIsQ0FBQyxDQUFTLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLFFBQVEsQ0FDcEM7UUFDRCxNQUFNLEVBQUUsSUFBSSx5QkFBVyxDQUN0QixvQkFBb0IsRUFDcEIsQ0FBQyxDQUFTLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLFFBQVEsQ0FDcEM7UUFDRCxPQUFPLEVBQUUsSUFBSSx5QkFBVyxDQUN2QixxQkFBcUIsRUFDckIsQ0FBQyxDQUFVLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLFNBQVMsQ0FDdEM7UUFDRCxJQUFJLEVBQUUsSUFBSSx5QkFBVyxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQU8sRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQztRQUM5RCxTQUFTLEVBQUUsSUFBSSx5QkFBVyxDQUN6QixxQkFBcUIsRUFDckIsQ0FBQyxDQUFZLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLFdBQVcsQ0FDMUM7UUFDRCxNQUFNLEVBQUUsSUFBSSx5QkFBVyxDQUN0QixvQkFBb0IsRUFDcEIsQ0FBQyxDQUFTLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLFFBQVEsQ0FDcEM7S0FD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LENBQUMsT0FBTyxDQUFDLENBQy9CLENBQUM7YUFDRjtpQkFBTTtnQkFDTixNQUFNLEtBQUssQ0FDVixnRUFBZ0U7b0JBQy9ELHNDQUFzQyxDQUN2QyxDQUFDO2FBQ0Y7UUFDRixDQUFDO0tBQ0QsQ0FBQztJQUVGLCtGQUNJLFNBQVMsR0FDVCxRQUFRLEdBQ1IsS0FBSyxHQUNMLFlBQVksR0FDWixTQUFTLEdBQ1QsT0FBTyxFQUNUO0FBQ0gsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUVMLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQG1vZHVsZSByZXN0cmljdC12XG4gKi9cblxuLyoqXG4gKiBAYXV0aG9yICBKdXN0aW4gQ29sbGllciA8anBjeGlzdEBnbWFpbC5jb20+XG4gKiBAbGljZW5zZSBHUEwtMy4wLW9yLWxhdGVyXG4gKiBAc2VlIHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9qcGN4L3Jlc3RyaWN0LXZ8R2l0SHVifVxuICovXG5cbi8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gICpcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gICpcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX18gICAgICAgICAuX18gICAgICAgIF9fICAgICAgICAgICAgICAgICAgICAgICpcbiAqICAgIF9fX19fX18gICBfX19fICAgX19fX19fXy8gIHxfX19fX19fX3xfX3wgX19fX18vICB8XyAgICAgICAgICBfX18gIF9fICAgICpcbiAqICAgIFxcXyAgX18gXFxfLyBfXyBcXCAvICBfX18vXFwgICBfX1xcXyAgX18gXFwgIHwvIF9fX1xcICAgX19cXCAgX19fX19fIFxcICBcXC8gLyAgICAqXG4gKiAgICAgfCAgfCBcXC9cXCAgX19fLyBcXF9fXyBcXCAgfCAgfCAgfCAgfCBcXC8gIFxcICBcXF9fX3wgIHwgICAvX19fX18vICBcXCAgIC8gICAgICpcbiAqICAgICB8X198ICAgIFxcX19fICA+X19fXyAgPiB8X198ICB8X198ICB8X198XFxfX18gID5fX3wgICAgICAgICAgICAgXFxfLyAgICAgICpcbiAqICAgICAgICAgICAgICAgICBcXC8gICAgIFxcLyAgICAgICAgICAgICAgICAgICAgICBcXC8gICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIFJ1bnRpbWUgVmFsdWUgUmVzdHJpY3RvciAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gICpcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gICpcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSAgICAgICpcbiAqICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSAgICAgICpcbiAqICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvciAgICAgICAgICpcbiAqICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgICAgICAgICAgICpcbiAqICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW50ZXJuYWxpZWQgd2FycmFudHkgb2YgICAgICAgICpcbiAqICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlICAgICAgICAgICAgICpcbiAqICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSAgICAgICAgICpcbiAqICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uICAgICpcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG5cbmltcG9ydCB7IERlZXBGcmVlemUgfSBmcm9tIFwiLi9kZWVwRnJlZXplXCI7XG5jb25zdCBkZWVwRnJlZXplID0gbmV3IERlZXBGcmVlemUoKTtcblxuaW1wb3J0IHsgQ29uc3RydWN0b3JGdW5jdGlvbiB9IGZyb20gXCIuL3R5cGVzXCI7XG5cbmltcG9ydCB7IFJlc3RyaWN0aW9uIH0gZnJvbSBcIi4vcmVzdHJpY3Rpb25cIjtcblxuZXhwb3J0IGNvbnN0IHJlc3RyaWN0ID0gKCgpID0+IHtcblx0Y29uc3QgcHJpbWl0aXZlID0ge1xuXHRcdHN0cmluZzogbmV3IFJlc3RyaWN0aW9uKFxuXHRcdFx0XCJNdXN0IGJlIGEgJ3N0cmluZydcIixcblx0XHRcdCh2OiBzdHJpbmcpID0+IHR5cGVvZiB2ID09PSBcInN0cmluZ1wiXG5cdFx0KSxcblx0XHRudW1iZXI6IG5ldyBSZXN0cmljdGlvbihcblx0XHRcdFwiTXVzdCBiZSBhICdudW1iZXInXCIsXG5cdFx0XHQodjogbnVtYmVyKSA9PiB0eXBlb2YgdiA9PT0gXCJudW1iZXJcIlxuXHRcdCksXG5cdFx0YmlnaW50OiBuZXcgUmVzdHJpY3Rpb24oXG5cdFx0XHRcIk11c3QgYmUgYSAnYmlnaW50J1wiLFxuXHRcdFx0KHY6IGJpZ2ludCkgPT4gdHlwZW9mIHYgPT09IFwiYmlnaW50XCJcblx0XHQpLFxuXHRcdGJvb2xlYW46IG5ldyBSZXN0cmljdGlvbihcblx0XHRcdFwiTXVzdCBiZSBhICdib29sZWFuJ1wiLFxuXHRcdFx0KHY6IGJvb2xlYW4pID0+IHR5cGVvZiB2ID09PSBcImJvb2xlYW5cIlxuXHRcdCksXG5cdFx0bnVsbDogbmV3IFJlc3RyaWN0aW9uKFwiTXVzdCBiZSBudWxsXCIsICh2OiBudWxsKSA9PiB2ID09PSBudWxsKSxcblx0XHR1bmRlZmluZWQ6IG5ldyBSZXN0cmljdGlvbihcblx0XHRcdFwiTXVzdCBiZSAndW5kZWZpbmVkJ1wiLFxuXHRcdFx0KHY6IHVuZGVmaW5lZCkgPT4gdHlwZW9mIHYgPT09IFwidW5kZWZpbmVkXCJcblx0XHQpLFxuXHRcdHN5bWJvbDogbmV3IFJlc3RyaWN0aW9uKFxuXHRcdFx0XCJNdXN0IGJlIGEgJ3N5bWJvbCdcIixcblx0XHRcdCh2OiBzeW1ib2wpID0+IHR5cGVvZiB2ID09PSBcInN5bWJvbFwiXG5cdFx0KVxuXHR9O1xuXG5cdGNvbnN0IGVxdWFsaXR5ID0ge1xuXHRcdGVxOiA8VD4odGFyZ2V0OiBUKSA9PlxuXHRcdFx0bmV3IFJlc3RyaWN0aW9uKFxuXHRcdFx0XHRcIk11c3QgYmUgc3RyaWN0bHkgZXF1YWwgdG8gXCIgKyB0YXJnZXQsXG5cdFx0XHRcdCh2OiBUKSA9PiB2ID09PSB0YXJnZXRcblx0XHRcdCksXG5cdFx0bmVxOiA8VD4odGFyZ2V0OiBUKSA9PlxuXHRcdFx0bmV3IFJlc3RyaWN0aW9uKFxuXHRcdFx0XHRcIk11c3Qgbm90IGJlIHN0cmljdGx5IGVxdWFsIHRvIFwiICsgdGFyZ2V0LFxuXHRcdFx0XHQodjogVCkgPT4gdiAhPT0gdGFyZ2V0XG5cdFx0XHQpXG5cdH07XG5cblx0Y29uc3QgcmFuZ2UgPSB7XG5cdFx0aW50ZWdlcjogbmV3IFJlc3RyaWN0aW9uKFwiTXVzdCBiZSBhbiBpbnRlZ2VyXCIsICh2OiBudW1iZXIgfCBiaWdpbnQpID0+IHtcblx0XHRcdGlmICh0eXBlb2YgdiA9PT0gXCJiaWdpbnRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIHYgPT09IFwibnVtYmVyXCIpIHtcblx0XHRcdFx0cmV0dXJuIE1hdGguZmxvb3IodikgPT09IHY7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSksXG5cblx0XHRndDogPE4gZXh0ZW5kcyBudW1iZXIgfCBiaWdpbnQsIFQgPSBOIGV4dGVuZHMgbnVtYmVyID8gbnVtYmVyIDogYmlnaW50Pihcblx0XHRcdGJvdW5kOiBOXG5cdFx0KSA9PiB7XG5cdFx0XHRpZiAodHlwZW9mIGJvdW5kID09PSBcIm51bWJlclwiIHx8IHR5cGVvZiBib3VuZCA9PT0gXCJiaWdpbnRcIikge1xuXHRcdFx0XHRyZXR1cm4gbmV3IFJlc3RyaWN0aW9uPFQ+KFxuXHRcdFx0XHRcdGBNdXN0IGJlIGEgJyR7dHlwZW9mIGJvdW5kfScgZ3JlYXRlciB0aGFuICR7Ym91bmR9YCxcblx0XHRcdFx0XHQodjogVCkgPT4gdHlwZW9mIHYgPT09IHR5cGVvZiBib3VuZCAmJiB2ID4gKGJvdW5kIGFzIE4gJiBUKVxuXHRcdFx0XHQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHRcdFwiW3Jlc3RyaWN0LXZdIEludmFsaWQgQXJndW1lbnQ6IHJlc3RyaWN0Lmd0IGNyZWF0aW9uIHJlcXVpcmVzIGEgXCIgK1xuXHRcdFx0XHRcdFx0XCJib3VuZCBvZiB0eXBlICdudW1iZXInIG9yICdiaWdpbnQnXCJcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0bHQ6IDxOIGV4dGVuZHMgbnVtYmVyIHwgYmlnaW50LCBUID0gTiBleHRlbmRzIG51bWJlciA/IG51bWJlciA6IGJpZ2ludD4oXG5cdFx0XHRib3VuZDogTlxuXHRcdCkgPT4ge1xuXHRcdFx0aWYgKHR5cGVvZiBib3VuZCA9PT0gXCJudW1iZXJcIiB8fCB0eXBlb2YgYm91bmQgPT09IFwiYmlnaW50XCIpIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBSZXN0cmljdGlvbjxUPihcblx0XHRcdFx0XHRgTXVzdCBiZSBhICcke3R5cGVvZiBib3VuZH0nIGxlc3MgdGhhbiAke2JvdW5kfWAsXG5cdFx0XHRcdFx0KHY6IFQpID0+IHR5cGVvZiB2ID09PSB0eXBlb2YgYm91bmQgJiYgdiA8IChib3VuZCBhcyBOICYgVClcblx0XHRcdFx0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0XHRcIltyZXN0cmljdC12XSBJbnZhbGlkIEFyZ3VtZW50OiByZXN0cmljdC5sdCBjcmVhdGlvbiByZXF1aXJlcyBcIiArXG5cdFx0XHRcdFx0XHRcImEgYm91bmQgb2YgdHlwZSAnbnVtYmVyJyBvciAnYmlnaW50J1wiXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdGd0ZTogPE4gZXh0ZW5kcyBudW1iZXIgfCBiaWdpbnQsIFQgPSBOIGV4dGVuZHMgbnVtYmVyID8gbnVtYmVyIDogYmlnaW50Pihcblx0XHRcdGJvdW5kOiBOXG5cdFx0KSA9PiB7XG5cdFx0XHRpZiAodHlwZW9mIGJvdW5kID09PSBcIm51bWJlclwiIHx8IHR5cGVvZiBib3VuZCA9PT0gXCJiaWdpbnRcIikge1xuXHRcdFx0XHRyZXR1cm4gbmV3IFJlc3RyaWN0aW9uPFQ+KFxuXHRcdFx0XHRcdGBNdXN0IGJlIGEgJyR7dHlwZW9mIGJvdW5kfScgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvICR7Ym91bmR9YCxcblx0XHRcdFx0XHQodjogVCkgPT4gdHlwZW9mIHYgPT09IHR5cGVvZiBib3VuZCAmJiB2ID49IChib3VuZCBhcyBOICYgVClcblx0XHRcdFx0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0XHRcIltyZXN0cmljdC12XSBJbnZhbGlkIEFyZ3VtZW50OiByZXN0cmljdC5ndGUgY3JlYXRpb24gcmVxdWlyZXMgXCIgK1xuXHRcdFx0XHRcdFx0XCJhIGJvdW5kIG9mIHR5cGUgJ251bWJlcicgb3IgJ2JpZ2ludCdcIlxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRsdGU6IDxOIGV4dGVuZHMgbnVtYmVyIHwgYmlnaW50LCBUID0gTiBleHRlbmRzIG51bWJlciA/IG51bWJlciA6IGJpZ2ludD4oXG5cdFx0XHRib3VuZDogTlxuXHRcdCkgPT4ge1xuXHRcdFx0aWYgKHR5cGVvZiBib3VuZCA9PT0gXCJudW1iZXJcIiB8fCB0eXBlb2YgYm91bmQgPT09IFwiYmlnaW50XCIpIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBSZXN0cmljdGlvbjxUPihcblx0XHRcdFx0XHRgTXVzdCBiZSBhICcke3R5cGVvZiBib3VuZH0nIGxlc3MgdGhhbiBvciBlcXVhbCB0byAke2JvdW5kfWAsXG5cdFx0XHRcdFx0KHY6IFQpID0+IHR5cGVvZiB2ID09PSB0eXBlb2YgYm91bmQgJiYgdiA8PSAoYm91bmQgYXMgTiAmIFQpXG5cdFx0XHRcdCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRcdFx0XCJbcmVzdHJpY3Qtdl0gSW52YWxpZCBBcmd1bWVudDogcmVzdHJpY3QubHRlIGNyZWF0aW9uIHJlcXVpcmVzIFwiICtcblx0XHRcdFx0XHRcdFwiYSBib3VuZCBvZiB0eXBlICdudW1iZXInIG9yICdiaWdpbnQnXCJcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0cmFuZ2U6IDxcblx0XHRcdE5Mb3dlciBleHRlbmRzIG51bWJlciB8IGJpZ2ludCxcblx0XHRcdE5VcHBlciBleHRlbmRzIE5Mb3dlciBleHRlbmRzIG51bWJlciA/IG51bWJlciA6IGJpZ2ludCxcblx0XHRcdFQgPSBOTG93ZXIgZXh0ZW5kcyBudW1iZXIgPyBudW1iZXIgOiBiaWdpbnRcblx0XHQ+KFxuXHRcdFx0bG93ZXI6IE5Mb3dlcixcblx0XHRcdHVwcGVyOiBOVXBwZXIsXG5cdFx0XHRsb3dlckluY2x1c2l2ZTogYm9vbGVhbiA9IHRydWUsXG5cdFx0XHR1cHBlckluY2x1c2l2ZTogYm9vbGVhbiA9IGZhbHNlXG5cdFx0KSA9PiB7XG5cdFx0XHRpZiAoXG5cdFx0XHRcdHR5cGVvZiBsb3dlciA9PT0gdHlwZW9mIHVwcGVyICYmXG5cdFx0XHRcdCh0eXBlb2YgbG93ZXIgPT09IFwibnVtYmVyXCIgfHwgdHlwZW9mIGxvd2VyID09PSBcImJpZ2ludFwiKVxuXHRcdFx0KSB7XG5cdFx0XHRcdHJldHVybiBuZXcgUmVzdHJpY3Rpb248VD4oXG5cdFx0XHRcdFx0YE11c3QgYmUgYSAnJHt0eXBlb2YgbG93ZXJ9JyB3aXRoaW4gdGhlIHJhbmdlICR7XG5cdFx0XHRcdFx0XHRsb3dlckluY2x1c2l2ZSA/IFwiW1wiIDogXCIoXCJcblx0XHRcdFx0XHR9JHtsb3dlcn0sICR7dXBwZXJ9JHt1cHBlckluY2x1c2l2ZSA/IFwiXVwiIDogXCIpXCJ9YCxcblx0XHRcdFx0XHRsb3dlckluY2x1c2l2ZSA/IHJhbmdlLmd0ZShsb3dlcikgOiByYW5nZS5ndChsb3dlciksXG5cdFx0XHRcdFx0dXBwZXJJbmNsdXNpdmUgPyByYW5nZS5sdGUodXBwZXIpIDogcmFuZ2UubHQodXBwZXIpXG5cdFx0XHRcdCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRcdFx0XCJbcmVzdHJpY3Qtdl0gSW52YWxpZCBBcmd1bWVudDogcmVzdHJpY3QucmFuZ2UgY3JlYXRpb24gcmVxdWlyZXMgXCIgK1xuXHRcdFx0XHRcdFx0XCJzYW1lLXR5cGVkIGxvd2VyIGFuZCB1cHBlciBib3VuZHMgb2YgdHlwZSAnbnVtYmVyJyBvciAnYmlnaW50J1wiXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdGNvbnN0IHJhbmdlUHJlc2V0cyA9IHtcblx0XHRwb3NpdGl2ZTogcmFuZ2Vcblx0XHRcdC5ndGUoMClcblx0XHRcdC5vcihyYW5nZS5ndGUoQmlnSW50KDApKSlcblx0XHRcdC5tc2coXCJNdXN0IGJlIGEgcG9zaXRpdmUgJ251bWJlcicgb3IgJ2JpZ2ludCdcIiksXG5cdFx0bmVnYXRpdmU6IHJhbmdlXG5cdFx0XHQubHQoMClcblx0XHRcdC5vcihyYW5nZS5sdChCaWdJbnQoMCkpKVxuXHRcdFx0Lm1zZyhcIk11c3QgYmUgYSBuZWdhdGl2ZSAnbnVtYmVyJyBvciAnYmlnaW50J1wiKVxuXHR9O1xuXG5cdGNvbnN0IGluc3RhbmNlcyA9IHtcblx0XHRPYmplY3Q6IG5ldyBSZXN0cmljdGlvbihcblx0XHRcdFwiTXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBPYmplY3RcIixcblx0XHRcdCh2OiBvYmplY3QpID0+IHYgaW5zdGFuY2VvZiBPYmplY3Rcblx0XHQpLFxuXHRcdEFycmF5OiBuZXcgUmVzdHJpY3Rpb24oXG5cdFx0XHRcIk11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgQXJyYXlcIixcblx0XHRcdCh2OiBhbnlbXSkgPT4gdiBpbnN0YW5jZW9mIEFycmF5XG5cdFx0KSxcblx0XHRpbnN0YW5jZW9mOiA8VD4oaW5zdGFuY2U6IENvbnN0cnVjdG9yRnVuY3Rpb248VD4pID0+XG5cdFx0XHRuZXcgUmVzdHJpY3Rpb24oXG5cdFx0XHRcdGBNdXN0IGJlIGFuIGluc3RhbmNlIG9mICR7aW5zdGFuY2UubmFtZX1gLFxuXHRcdFx0XHQodmFsdWU6IFQpID0+IHZhbHVlIGluc3RhbmNlb2YgaW5zdGFuY2Vcblx0XHRcdClcblx0fTtcblxuXHRjb25zdCBzdHJpbmdzID0ge1xuXHRcdG1hdGNoOiAobWF0Y2hlcjogc3RyaW5nIHwgUmVnRXhwKSA9PiB7XG5cdFx0XHRpZiAobWF0Y2hlciBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuXHRcdFx0XHRyZXR1cm4gcHJpbWl0aXZlLnN0cmluZy5hbmQoXG5cdFx0XHRcdFx0XCJNdXN0IGJlIGEgJ3N0cmluZycgbWF0Y2hpbmcgXCIgKyBtYXRjaGVyLnRvU3RyaW5nKCksXG5cdFx0XHRcdFx0KHY6IHN0cmluZykgPT4gdi5tYXRjaChtYXRjaGVyKVxuXHRcdFx0XHQpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgbWF0Y2hlciA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRyZXR1cm4gcHJpbWl0aXZlLnN0cmluZy5hbmQoXG5cdFx0XHRcdFx0XCJNdXN0IGJlIGEgJ3N0cmluZycgbWF0Y2hpbmcgJ1wiICsgbWF0Y2hlciArIFwiJ1wiLFxuXHRcdFx0XHRcdCh2OiBzdHJpbmcpID0+IHYubWF0Y2gobWF0Y2hlcilcblx0XHRcdFx0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRocm93IEVycm9yKFxuXHRcdFx0XHRcdFwiW3Jlc3RyaWN0LXZdIEludmFsaWQgQXJndW1lbnQ6IE11c3Qgc3VwcGx5IGEgc3RyaW5nIG9yIFJlZ0V4cCBcIiArXG5cdFx0XHRcdFx0XHRcImluc3RhbmNlIGZvciByZXN0cmljdC5tYXRjaCBjcmVhdGlvblwiXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdHJldHVybiB7XG5cdFx0Li4ucHJpbWl0aXZlLFxuXHRcdC4uLmVxdWFsaXR5LFxuXHRcdC4uLnJhbmdlLFxuXHRcdC4uLnJhbmdlUHJlc2V0cyxcblx0XHQuLi5pbnN0YW5jZXMsXG5cdFx0Li4uc3RyaW5nc1xuXHR9O1xufSkoKTtcblxuZGVlcEZyZWV6ZSh0aGlzKTtcbiJdfQ==